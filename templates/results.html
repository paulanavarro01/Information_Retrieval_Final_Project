{% extends "base.html" %}
{% block page_title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container py-5">

    <h3 class="mb-4 text-center fw-bold">Search Results</h3>
    <p class="text-muted text-center mb-4">Found <strong>{{ found_counter }}</strong> results for "<em>{{ search_query }}</em>"</p>

    {% if rag_response %}
    <div class="alert alert-info shadow-sm">
        <h5 class="fw-bold">AI-Generated Summary</h5>
        <p>{{ rag_response }}</p>
    </div>
    {% endif %}

    <div class="row g-4">
        {% for item in results_list %}
        <div class="col-lg-6">
            <div class="card shadow-sm h-100 hover-shadow rounded-4">
                <div class="row g-0">
                    {% if item.images and item.images[0] %}
                    <div class="col-md-4 d-flex align-items-center justify-content-center p-3 bg-light">
                        <img src="{{ item.images[0] }}" class="img-fluid rounded" style="max-height:120px; object-fit:contain;" alt="{{ item.title }}">
                    </div>
                    {% endif %}
                    <div class="col-md">
                        <div class="card-body">
                            <h5 class="card-title mb-2">
                                <a href="{{ item.url }}" class="text-decoration-none text-primary fw-bold">{{ item.title }}</a>
                            </h5>
                            {% if item.brand %}
                            <p class="text-muted small mb-1">{{ item.brand }}{% if item.category %} — {{ item.category }}{% endif %}</p>
                            {% endif %}
                            {% if item.description %}
                            <p class="card-text mb-2" style="font-size: 0.95rem;">
                                {% set words = item.description.split()[:25] %}
                                {% set query_words = search_query.lower().split() %}
                                {% for w in words %}
                                    {% if w|lower in query_words %}
                                        <strong>{{ w }}</strong>
                                    {% else %}
                                        {{ w }}
                                    {% endif %}
                                    {% if not loop.last %} {% endif %}
                                {% endfor %}...
                            </p>
                            {% endif %}
                            {% if item.selling_price %}
                            <p class="mb-0 fw-bold">₹{{ item.selling_price }}{% if item.discount %} ({{ item.discount }}% off){% endif %}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.hover-shadow:hover {
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;
    transform: translateY(-2px);
    transition: 0.3s;
}
</style>
{% endblock %}
